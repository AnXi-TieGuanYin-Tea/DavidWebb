<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="DavidWebb : Lightweight Java HTTP-Client for calling JSON REST-Services (especially for Android)" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>DavidWebb</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/hgoebl/DavidWebb">View on GitHub</a>

          <h1 id="project_title">DavidWebb</h1>
          <h2 id="project_tagline">Lightweight Java HTTP-Client for calling JSON REST-Services (especially for Android)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/hgoebl/DavidWebb/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/hgoebl/DavidWebb/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a name="davidwebb" class="anchor" href="#davidwebb"><span class="octicon octicon-link"></span></a>DavidWebb</h1>

<p>Lightweight Java HTTP-Client for calling JSON REST-Services (especially made for Android).</p>

<h2>
<a name="problem" class="anchor" href="#problem"><span class="octicon octicon-link"></span></a>Problem</h2>

<p>If you have to call a RESTful Webservice from Java, especially if you are on Android, you have some options:</p>

<ul>
<li>Use <code>DefaultHttpClient</code> or <code>AndroidHttpClient</code>. It is already deployed on Android and it's easy to use.
But wait a moment -
<a href="http://android-developers.blogspot.de/2011/09/androids-http-clients.html">Google doesn't recommend using it</a>,
only on very old Android versions.</li>
<li>Use <code>HttpURLConnection</code>. This is what Google recommends for newer Android versions (&gt;= Gingerbread).
It is part of JDK, but it's cumbersome to use (if not to say a nightmare).</li>
<li>Add <code>Unirest</code>, <code>Restlet</code> or some other "all-you-can-eat", universal, multi-part, File-upload and all-cases
supporting library which adds some hundred KB of jars to your APK.</li>
</ul><h2>
<a name="solved" class="anchor" href="#solved"><span class="octicon octicon-link"></span></a>Solved</h2>

<p><strong>DavidWebb</strong> is a small wrapper around
<a href="http://docs.oracle.com/javase/7/docs/api/java/net/HttpURLConnection.html">HttpURLConnection</a>.
It supports most HTTP communication cases when you talk to REST services and your data is JSON. It is very
lightweight (~16 KB jar) and super-easy to use.</p>

<h2>
<a name="features" class="anchor" href="#features"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Supports GET, POST, PUT, DELETE</li>
<li>add HTTP headers (per request, per client or globally)</li>
<li>convert params to <code>x-www-form-urlencoded</code> body <strong>or</strong> URI search params</li>
<li>fluent API</li>
<li>org.json support (JSONObject, JSONArray) as payload in both directions (up/down)</li>
<li>wraps all Exceptions in a WebbException (a RuntimeException)</li>
<li>automatically sets many boiler-plate HTTP headers (like 'Accept', 'Content-Type', 'Content-Length')</li>
<li>supports HTTPS and enables relaxing SSL-handshake (self-signed certificates, hostname verification)</li>
<li>pass-through to "real" connection for special cases</li>
</ul><h2>
<a name="non-features" class="anchor" href="#non-features"><span class="octicon octicon-link"></span></a>Non-Features</h2>

<p>Following features are not supported and there are no plans to realize them:</p>

<ul>
<li>Cookie management (read <code>Set-Cookie</code> header from response and set <code>Cookie</code> header for request)</li>
<li>Comfortable Basic Authentication (it's not hard to implement it above of DavidWebb, see below)</li>
<li>Multi-Part upload</li>
<li>Mixing URL-parameters and x-www-form-urlencoded POST bodies.<br>
Workaround: build the URI with the help of <code>WebbUtils.queryString</code> and use <code>Request.param()</code> for
the form-fields.</li>
</ul><p>Where not stated, the workaround is to use another library or implement it above of DavidWebb.
If you think your implementation might be useful for others and it's not blowing up the size of
the JAR, please create a pull request. (Adding heavy dependencies is not an option.)</p>

<h1>
<a name="usage-examples" class="anchor" href="#usage-examples"><span class="octicon octicon-link"></span></a>Usage Examples</h1>

<p>Below you can see some examples of how to use DavidWebb. And here you can find the
<a href="http://hgoebl.github.io/DavidWebb/apidocs/">API Documentation</a>.</p>

<p>This is some code from a SyncAdapter of an Android App:</p>

<div class="highlight highlight-java"><pre><span class="c1">// create the client (one-time, can be used from different threads)</span>
<span class="n">Webb</span> <span class="n">webb</span> <span class="o">=</span> <span class="n">Webb</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
<span class="n">webb</span><span class="o">.</span><span class="na">setBaseUri</span><span class="o">(</span><span class="n">SyncPreferences</span><span class="o">.</span><span class="na">REST_ENDPOINT</span><span class="o">);</span>
<span class="n">webb</span><span class="o">.</span><span class="na">setDefaultHeader</span><span class="o">(</span><span class="n">Webb</span><span class="o">.</span><span class="na">HDR_USER_AGENT</span><span class="o">,</span> <span class="n">Const</span><span class="o">.</span><span class="na">UA</span><span class="o">);</span>

<span class="c1">// later we authenticate</span>
<span class="n">Response</span><span class="o">&lt;</span><span class="n">JSONObject</span><span class="o">&gt;</span> <span class="n">response</span> <span class="o">=</span> <span class="n">webb</span>
        <span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/session"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"authentication"</span><span class="o">,</span> <span class="n">createAuthentication</span><span class="o">(</span><span class="n">syncPreferences</span><span class="o">))</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"deviceId"</span><span class="o">,</span> <span class="n">syncPrefs</span><span class="o">.</span><span class="na">getDeviceId</span><span class="o">())</span>
        <span class="o">.</span><span class="na">ensureSuccess</span><span class="o">()</span>
        <span class="o">.</span><span class="na">asJsonObject</span><span class="o">();</span>

<span class="n">JSONObject</span> <span class="n">apiResult</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="na">getBody</span><span class="o">();</span>

<span class="n">AccessToken</span> <span class="n">accessToken</span> <span class="o">=</span> <span class="k">new</span> <span class="n">AccessToken</span><span class="o">();</span>
<span class="n">accessToken</span><span class="o">.</span><span class="na">token</span> <span class="o">=</span> <span class="n">apiResult</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">"token"</span><span class="o">);</span>
<span class="n">accessToken</span><span class="o">.</span><span class="na">validUntil</span> <span class="o">=</span> <span class="n">apiResult</span><span class="o">.</span><span class="na">getLong</span><span class="o">(</span><span class="s">"validUntil"</span><span class="o">);</span>

<span class="n">webb</span><span class="o">.</span><span class="na">setDefaultHeader</span><span class="o">(</span><span class="n">HDR_ACCESS_TOKEN</span><span class="o">,</span> <span class="n">accessToken</span><span class="o">.</span><span class="na">token</span><span class="o">);</span>

<span class="n">JSONObject</span> <span class="n">sync</span> <span class="o">=</span> <span class="n">webb</span><span class="o">.</span><span class="na">post</span><span class="o">(</span><span class="s">"/startSync"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"lastSync"</span><span class="o">,</span> <span class="n">syncPrefs</span><span class="o">.</span><span class="na">getLastSync</span><span class="o">())</span>
        <span class="o">.</span><span class="na">ensureSuccess</span><span class="o">()</span>
        <span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getBody</span><span class="o">();</span>

<span class="c1">// ... etc. etc.</span>

<span class="c1">// releaseAccessToken</span>
<span class="n">webb</span><span class="o">.</span><span class="na">delete</span><span class="o">(</span><span class="s">"/session"</span><span class="o">).</span><span class="na">asVoid</span><span class="o">();</span>
<span class="n">accessToken</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</pre></div>

<p>Using Google Directions API:</p>

<div class="highlight highlight-java"><pre><span class="n">Webb</span> <span class="n">webb</span> <span class="o">=</span> <span class="n">Webb</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
<span class="n">JSONObject</span> <span class="n">result</span> <span class="o">=</span> <span class="n">webb</span>
        <span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"http://maps.googleapis.com/maps/api/directions/json"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"origin"</span><span class="o">,</span> <span class="k">new</span> <span class="n">GeoPoint</span><span class="o">(</span><span class="mf">47.8227</span><span class="o">,</span> <span class="mf">12.096933</span><span class="o">))</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"destination"</span><span class="o">,</span> <span class="k">new</span> <span class="n">GeoPoint</span><span class="o">(</span><span class="mf">47.8633</span><span class="o">,</span> <span class="mf">12.215533</span><span class="o">))</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"mode"</span><span class="o">,</span> <span class="s">"walking"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">param</span><span class="o">(</span><span class="s">"sensor"</span><span class="o">,</span> <span class="s">"true"</span><span class="o">)</span>
        <span class="o">.</span><span class="na">ensureSuccess</span><span class="o">()</span>
        <span class="o">.</span><span class="na">asJsonObject</span><span class="o">()</span>
        <span class="o">.</span><span class="na">getBody</span><span class="o">();</span>

<span class="n">JSONArray</span> <span class="n">routes</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="na">getJSONArray</span><span class="o">(</span><span class="s">"routes"</span><span class="o">);</span>
</pre></div>

<p>You have to do Basic Authentication?</p>

<p>This authorization method uses a Base64 encoded string. Unfortunately Java SE doesn't provide a
Base64 encoder. Because DavidWebb wants to be light and Android already provides a Base64 support class,
it's left to you to insert a few lines of code. As you can see, it's not hard work.
Use one of the methods to set a header and set Authorization header by yourself:</p>

<div class="highlight highlight-java"><pre><span class="kt">byte</span><span class="o">[]</span> <span class="n">credentials</span> <span class="o">=</span> <span class="o">(</span><span class="n">username</span> <span class="o">+</span> <span class="s">":"</span> <span class="o">+</span> <span class="n">password</span><span class="o">).</span><span class="na">getBytes</span><span class="o">(</span><span class="s">"UTF-8"</span><span class="o">);</span>
<span class="n">String</span> <span class="n">auth</span> <span class="o">=</span> <span class="s">"Basic "</span> <span class="o">+</span> <span class="n">Base64</span><span class="o">.</span><span class="na">encodeToString</span><span class="o">(</span><span class="n">credentials</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
<span class="n">Webb</span> <span class="n">webb</span> <span class="o">=</span> <span class="n">Webb</span><span class="o">.</span><span class="na">create</span><span class="o">();</span>
<span class="n">webb</span><span class="o">.</span><span class="na">setDefaultHeader</span><span class="o">(</span><span class="n">Webb</span><span class="o">.</span><span class="na">HDR_AUTHORIZATION</span><span class="o">,</span> <span class="n">auth</span><span class="o">);</span>
</pre></div>

<p>If you want to see more examples, just have a look at the JUnit TestCase (src/test/java/...).</p>

<h2>
<a name="special-case-android--froyo" class="anchor" href="#special-case-android--froyo"><span class="octicon octicon-link"></span></a>Special Case Android &lt; Froyo</h2>

<p>You should add this if you build for legacy Android devices:</p>

<div class="highlight highlight-java"><pre><span class="k">if</span> <span class="o">(</span><span class="n">Integer</span><span class="o">.</span><span class="na">parseInt</span><span class="o">(</span><span class="n">Build</span><span class="o">.</span><span class="na">VERSION</span><span class="o">.</span><span class="na">SDK</span><span class="o">)</span> <span class="o">&lt;</span> <span class="n">Build</span><span class="o">.</span><span class="na">VERSION_CODES</span><span class="o">.</span><span class="na">FROYO</span><span class="o">)</span> <span class="o">{</span>
    <span class="n">System</span><span class="o">.</span><span class="na">setProperty</span><span class="o">(</span><span class="s">"http.keepAlive"</span><span class="o">,</span> <span class="s">"false"</span><span class="o">);</span>
<span class="o">}</span>
</pre></div>

<h1>
<a name="background" class="anchor" href="#background"><span class="octicon octicon-link"></span></a>Background</h1>

<h2>
<a name="not-for-you" class="anchor" href="#not-for-you"><span class="octicon octicon-link"></span></a>Not for you?</h2>

<p>If <strong>DavidWebb</strong> is too lightweight and you're missing features, you can have a look at:</p>

<ul>
<li><a href="https://github.com/PCreations/RESTDroid">RESTDroid</a></li>
<li><a href="https://github.com/octo-online/robospice">RoboSpice</a></li>
<li><a href="https://github.com/darko1002001/android-rest-client">android-rest-client</a></li>
<li><a href="http://unirest.io/">unirest</a></li>
<li><a href="http://restlet.org/">Restlet Framework</a></li>
<li>
<a href="https://android.googlesource.com/platform/frameworks/volley">Volley</a> and
<a href="http://www.technotalkative.com/android-volley-library-example/">Volley Example</a>
</li>
<li>
<a href="http://datadroid.foxykeep.com/">DataDroid</a> - an Android library for Data Management</li>
<li><a href="https://github.com/octo-online/robospice#alternatives-to-robospice-">More Alternatives (on RoboSpice)</a></li>
<li>(tell me if I missed your award-winning REST-client library!)</li>
</ul><h2>
<a name="the-name" class="anchor" href="#the-name"><span class="octicon octicon-link"></span></a>The Name!?</h2>

<p>David <strong>Webb</strong> is the real name of <strong>Jason</strong> Bourne.</p>

<p>So <strong>JSON</strong> and <strong>Web</strong>, did you get it? OK, might be silly, but Bourne 1-3 are my favorite films and so at
least I can remember the name.</p>

<p>From Wikipedia:</p>

<blockquote>
<p><a href="http://en.wikipedia.org/wiki/Jason_Bourne">Jason Bourne</a> is a fictional character and the protagonist
of a series of novels by Robert Ludlum and subsequent film adaptations</p>
</blockquote>

<h1>
<a name="license" class="anchor" href="#license"><span class="octicon octicon-link"></span></a>License</h1>

<p>MIT License, see LICENSE file</p>

<h1>
<a name="testing" class="anchor" href="#testing"><span class="octicon octicon-link"></span></a>Testing</h1>

<p>The Unit-Tests do not mock any network-libraries, but depend on a small Express-application running.</p>

<h2>
<a name="setup" class="anchor" href="#setup"><span class="octicon octicon-link"></span></a>Setup</h2>

<pre><code>cd src/test/api-test-server
npm install
node .
</code></pre>

<p>If you don't want to do this, just skip the tests in Maven build <code>-DskipTests</code></p>

<p>And if you don't want to build the library, just take the jar from the <code>dist</code> folder.</p>

<h1>
<a name="todo" class="anchor" href="#todo"><span class="octicon octicon-link"></span></a>TODO</h1>

<h2>
<a name="features-planned" class="anchor" href="#features-planned"><span class="octicon octicon-link"></span></a>Features (planned)</h2>

<ul>
<li>unprefixJson <a href="http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx">http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx</a>
</li>
</ul><h2>
<a name="features-only-ideas" class="anchor" href="#features-only-ideas"><span class="octicon octicon-link"></span></a>Features (only ideas)</h2>

<ul>
<li>decorator/interceptor beforeSend - provide hooks to manipulate request before send</li>
<li>decorator/interceptor afterReceive - provide hooks to manipulate raw response after receiving it</li>
</ul><p>Create an issue if you want to have one of those ideas implemented.</p>

<h2>
<a name="documentation--distribution" class="anchor" href="#documentation--distribution"><span class="octicon octicon-link"></span></a>Documentation / Distribution</h2>

<ul>
<li>Extend Tests, test against httpbin.org</li>
<li>Upload maven artifact to central repository (OMG how easy this would be with node.js and npm!)</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">DavidWebb maintained by <a href="https://github.com/hgoebl">hgoebl</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
