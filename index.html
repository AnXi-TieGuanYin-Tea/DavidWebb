<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="DavidWebb : Lightweight Java HTTP-Client for calling JSON REST-Services (especially for Android)">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>DavidWebb</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/hgoebl/DavidWebb">View on GitHub</a>

          <h1 id="project_title">DavidWebb</h1>
          <h2 id="project_tagline">Lightweight Java HTTP-Client for calling JSON REST-Services (especially for Android)</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/hgoebl/DavidWebb/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/hgoebl/DavidWebb/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="davidwebb" class="anchor" href="#davidwebb" aria-hidden="true"><span class="octicon octicon-link"></span></a>DavidWebb</h1>

<p>Lightweight Java HTTP-Client for calling JSON REST-Services (especially made for Android).</p>

<h2>
<a id="problem" class="anchor" href="#problem" aria-hidden="true"><span class="octicon octicon-link"></span></a>Problem</h2>

<p>If you have to call a RESTful Webservice from Java, especially if you are on Android, you have some options:</p>

<ul>
<li>Use <code>DefaultHttpClient</code> or <code>AndroidHttpClient</code>. It is already deployed on Android and it's easy to use.
But wait a moment -
<a href="http://android-developers.blogspot.de/2011/09/androids-http-clients.html">Google doesn't recommend using it</a>,
only on very old Android versions.</li>
<li>Use <code>HttpURLConnection</code>. This is what Google recommends for newer Android versions (&gt;= Gingerbread).
It is part of JDK, but it's cumbersome to use (if not to say a nightmare).</li>
<li>Add <code>Unirest</code>, <code>Restlet</code> or some other "all-you-can-eat", universal, multi-part, File-upload and all-cases
supporting library which adds some hundred KB of jars to your APK.</li>
</ul>

<h2>
<a id="solved" class="anchor" href="#solved" aria-hidden="true"><span class="octicon octicon-link"></span></a>Solved</h2>

<p><strong>DavidWebb</strong> is a paper-thin wrapper around
<a href="http://docs.oracle.com/javase/7/docs/api/java/net/HttpURLConnection.html">HttpURLConnection</a>.
It supports most HTTP communication cases when you talk to REST services and your data is JSON. It is very
lightweight (~18 KB jar) and super-easy to use.</p>

<h2>
<a id="features" class="anchor" href="#features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features</h2>

<ul>
<li>Supports GET, POST, PUT, DELETE</li>
<li>add HTTP headers (per request, per client or globally)</li>
<li>convert params to <code>x-www-form-urlencoded</code> body <strong>or</strong> URI search params</li>
<li>fluent API</li>
<li>org.json support (JSONObject, JSONArray) as payload in both directions (up/down)</li>
<li>wraps all Exceptions in a WebbException (a RuntimeException)</li>
<li>automatically sets many boiler-plate HTTP headers (like 'Accept', 'Content-Type', 'Content-Length')</li>
<li>GZip-compression for uploads (POST/PUT)</li>
<li>Un-compress gzip/deflate downloads</li>
<li>supports HTTPS and enables relaxing SSL-handshake (self-signed certificates, hostname verification)</li>
<li>pass-through to "real" connection for special cases</li>
<li>option to retry the request in case of special errors (503, 504, 'connection reset by peer')</li>
</ul>

<h2>
<a id="non-features" class="anchor" href="#non-features" aria-hidden="true"><span class="octicon octicon-link"></span></a>Non-Features</h2>

<p>Following features are not supported and there are no plans to realize them:</p>

<ul>
<li>Cookie management (read <code>Set-Cookie</code> header from response and set <code>Cookie</code> header for request).
As DavidWebb is just a thin wrapper over HttpURLConnection, you can use <code>CookieManager</code>.</li>
<li>Comfortable Basic Authentication (it's not hard to implement it above of DavidWebb, see below)</li>
<li>Multi-Part upload</li>
<li>Mixing URL-parameters and x-www-form-urlencoded POST bodies.<br>
Workaround: build the URI with the help of <code>WebbUtils.queryString</code> and use <code>Request.param()</code> for
the form-fields.</li>
</ul>

<p>Where not stated, the workaround is to use another library or implement it above of DavidWebb.
If you think your implementation might be useful for others and it's not blowing up the size of
the JAR, please create a pull request. (Adding heavy dependencies is not an option.)</p>

<h1>
<a id="usage-examples" class="anchor" href="#usage-examples" aria-hidden="true"><span class="octicon octicon-link"></span></a>Usage Examples</h1>

<p>Below you can see some examples of how to use DavidWebb. And here you can find the
<a href="http://hgoebl.github.io/DavidWebb/apidocs/">API Documentation</a>.</p>

<p><strong>This is some code from a SyncAdapter of an Android App:</strong></p>

<div class="highlight highlight-source-java"><pre><span class="pl-c">// create the client (one-time, can be used from different threads)</span>
<span class="pl-smi">Webb</span> webb <span class="pl-k">=</span> <span class="pl-smi">Webb</span><span class="pl-k">.</span>create();
webb<span class="pl-k">.</span>setBaseUri(<span class="pl-smi">SyncPreferences</span><span class="pl-c1"><span class="pl-k">.</span>REST_ENDPOINT</span>);
webb<span class="pl-k">.</span>setDefaultHeader(<span class="pl-smi">Webb</span><span class="pl-c1"><span class="pl-k">.</span>HDR_USER_AGENT</span>, <span class="pl-smi">Const</span><span class="pl-c1"><span class="pl-k">.</span>UA</span>);

<span class="pl-c">// later we authenticate</span>
<span class="pl-k">Response&lt;<span class="pl-smi">JSONObject</span>&gt;</span> response <span class="pl-k">=</span> webb
        .post(<span class="pl-s"><span class="pl-pds">"</span>/session<span class="pl-pds">"</span></span>)
        .param(<span class="pl-s"><span class="pl-pds">"</span>authentication<span class="pl-pds">"</span></span>, createAuthentication(syncPreferences))
        .param(<span class="pl-s"><span class="pl-pds">"</span>deviceId<span class="pl-pds">"</span></span>, syncPreferences<span class="pl-k">.</span>getDeviceId())
        .ensureSuccess()
        .asJsonObject();

<span class="pl-smi">JSONObject</span> apiResult <span class="pl-k">=</span> response<span class="pl-k">.</span>getBody();

<span class="pl-smi">AccessToken</span> accessToken <span class="pl-k">=</span> <span class="pl-k">new</span> <span class="pl-smi">AccessToken</span>();
accessToken<span class="pl-k">.</span>token <span class="pl-k">=</span> apiResult<span class="pl-k">.</span>getString(<span class="pl-s"><span class="pl-pds">"</span>token<span class="pl-pds">"</span></span>);
accessToken<span class="pl-k">.</span>validUntil <span class="pl-k">=</span> apiResult<span class="pl-k">.</span>getLong(<span class="pl-s"><span class="pl-pds">"</span>validUntil<span class="pl-pds">"</span></span>);

webb<span class="pl-k">.</span>setDefaultHeader(<span class="pl-c1">HDR_ACCESS_TOKEN</span>, accessToken<span class="pl-k">.</span>token);

<span class="pl-smi">JSONObject</span> sync <span class="pl-k">=</span> webb<span class="pl-k">.</span>post(<span class="pl-s"><span class="pl-pds">"</span>/startSync<span class="pl-pds">"</span></span>)
        .param(<span class="pl-s"><span class="pl-pds">"</span>lastSync<span class="pl-pds">"</span></span>, syncPreferences<span class="pl-k">.</span>getLastSync())
        .ensureSuccess()
        .asJsonObject()
        .getBody();

<span class="pl-c">// ... etc. etc.</span>

<span class="pl-c">// releaseAccessToken</span>
webb<span class="pl-k">.</span>delete(<span class="pl-s"><span class="pl-pds">"</span>/session<span class="pl-pds">"</span></span>)<span class="pl-k">.</span>asVoid();
accessToken <span class="pl-k">=</span> <span class="pl-c1">null</span>;</pre></div>

<p><strong>Using Google Directions API:</strong></p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">Webb</span> webb <span class="pl-k">=</span> <span class="pl-smi">Webb</span><span class="pl-k">.</span>create();
<span class="pl-smi">JSONObject</span> result <span class="pl-k">=</span> webb
        .get(<span class="pl-s"><span class="pl-pds">"</span>http://maps.googleapis.com/maps/api/directions/json<span class="pl-pds">"</span></span>)
        .param(<span class="pl-s"><span class="pl-pds">"</span>origin<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">GeoPoint</span>(<span class="pl-c1">47.8227</span>, <span class="pl-c1">12.096933</span>))
        .param(<span class="pl-s"><span class="pl-pds">"</span>destination<span class="pl-pds">"</span></span>, <span class="pl-k">new</span> <span class="pl-smi">GeoPoint</span>(<span class="pl-c1">47.8633</span>, <span class="pl-c1">12.215533</span>))
        .param(<span class="pl-s"><span class="pl-pds">"</span>mode<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>walking<span class="pl-pds">"</span></span>)
        .param(<span class="pl-s"><span class="pl-pds">"</span>sensor<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>true<span class="pl-pds">"</span></span>)
        .ensureSuccess()
        .asJsonObject()
        .getBody();

<span class="pl-smi">JSONArray</span> routes <span class="pl-k">=</span> result<span class="pl-k">.</span>getJSONArray(<span class="pl-s"><span class="pl-pds">"</span>routes<span class="pl-pds">"</span></span>);</pre></div>

<p><strong>Deal with "connection reset by peer" or other recoverable errors</strong></p>

<p>Android (at least &gt;= GINGERBREAD) automatically sets the "Connection" header to "keep-alive".
This sometimes causes errors, because the server might already have closed the connection without
the mobile device knowing it. It would be cumbersome to cope with this and other situation where
a retry solved all problems. Since version 1.2.0 it is more comfortable for you:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-smi">Webb</span> webb <span class="pl-k">=</span> <span class="pl-smi">Webb</span><span class="pl-k">.</span>create();
<span class="pl-smi">JSONObject</span> result <span class="pl-k">=</span> webb
        .get(<span class="pl-s"><span class="pl-pds">"</span>https://example.com/api/request<span class="pl-pds">"</span></span>)
        .retry(<span class="pl-c1">1</span>, <span class="pl-c1">false</span>) <span class="pl-c">// at most one retry, don't do exponential backoff</span>
        .asJsonObject()
        .getBody();</pre></div>

<p>In many cases you will need to change the behaviour of how and when to retry a request.
For this, you can register your own <code>RetryManager</code>, see <code>webb.setRetryManager()</code>.</p>

<p><strong>You have to do Basic Authentication?</strong></p>

<p>This authorization method uses a Base64 encoded string. Unfortunately Java SE doesn't provide a
Base64 encoder. Because DavidWebb wants to be light and Android already provides a Base64 support class,
it's left to you to insert a few lines of code. As you can see, it's not hard work.
Use one of the methods to set a header and set Authorization header by yourself:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">byte</span>[] credentials <span class="pl-k">=</span> (username <span class="pl-k">+</span> <span class="pl-s"><span class="pl-pds">"</span>:<span class="pl-pds">"</span></span> <span class="pl-k">+</span> password)<span class="pl-k">.</span>getBytes(<span class="pl-s"><span class="pl-pds">"</span>UTF-8<span class="pl-pds">"</span></span>);
<span class="pl-smi">String</span> auth <span class="pl-k">=</span> <span class="pl-s"><span class="pl-pds">"</span>Basic <span class="pl-pds">"</span></span> <span class="pl-k">+</span> <span class="pl-smi">Base64</span><span class="pl-k">.</span>encodeToString(credentials, <span class="pl-c1">0</span>);
<span class="pl-smi">Webb</span> webb <span class="pl-k">=</span> <span class="pl-smi">Webb</span><span class="pl-k">.</span>create();
webb<span class="pl-k">.</span>setDefaultHeader(<span class="pl-smi">Webb</span><span class="pl-c1"><span class="pl-k">.</span>HDR_AUTHORIZATION</span>, auth);</pre></div>

<p><strong>More Samples</strong></p>

<p>If you want to see more examples, just have a look at the JUnit TestCase (src/test/java/...).</p>

<h2>
<a id="special-case-android--froyo" class="anchor" href="#special-case-android--froyo" aria-hidden="true"><span class="octicon octicon-link"></span></a>Special Case Android &lt; Froyo</h2>

<p>You should add this if you build for legacy Android devices:</p>

<div class="highlight highlight-source-java"><pre><span class="pl-k">if</span> (<span class="pl-smi">Build</span><span class="pl-c1"><span class="pl-k">.</span>VERSION<span class="pl-k">.</span>SDK_INT</span> <span class="pl-k">&lt;</span> <span class="pl-smi">Build</span><span class="pl-c1"><span class="pl-k">.</span>VERSION_CODES<span class="pl-k">.</span>FROYO</span>) {
    <span class="pl-smi">System</span><span class="pl-k">.</span>setProperty(<span class="pl-s"><span class="pl-pds">"</span>http.keepAlive<span class="pl-pds">"</span></span>, <span class="pl-s"><span class="pl-pds">"</span>false<span class="pl-pds">"</span></span>);
}</pre></div>

<h2>
<a id="in-case-of-problems" class="anchor" href="#in-case-of-problems" aria-hidden="true"><span class="octicon octicon-link"></span></a>In Case Of Problems</h2>

<p>I've encountered some problems which could be solved by disabling <strong>keep-alive</strong> of HTTP connections.
The solution above did not always work on recent versions of Android. To be sure to do without
keep-alive, you can set an HTTP header like this:</p>

<pre><code>// disable 'keep-alive' for all requests created by this instance of Webb
webb.setDefaultHeader("Connection", "close");

// disable only for this request
Request&lt;String&gt; request = webb.post("/some-resource").header("Connection", "close");
</code></pre>

<h1>
<a id="maven-coordinates" class="anchor" href="#maven-coordinates" aria-hidden="true"><span class="octicon octicon-link"></span></a>Maven Coordinates</h1>

<div class="highlight highlight-text-xml"><pre>&lt;<span class="pl-ent">dependency</span>&gt;
    &lt;<span class="pl-ent">groupId</span>&gt;com.goebl&lt;/<span class="pl-ent">groupId</span>&gt;
    &lt;<span class="pl-ent">artifactId</span>&gt;david-webb&lt;/<span class="pl-ent">artifactId</span>&gt;
    &lt;<span class="pl-ent">version</span>&gt;1.2.0&lt;/<span class="pl-ent">version</span>&gt;
&lt;/<span class="pl-ent">dependency</span>&gt;</pre></div>

<p>Gradle</p>

<pre><code>'com.goebl:david-webb:1.2.0'
</code></pre>

<p>Not using Maven/Gradle? - Then you can download the plain JAR from following links directly:</p>

<ul>
<li><a href="https://oss.sonatype.org/content/groups/staging/com/goebl/david-webb/">SNAPSHOT Versions</a></li>
<li><a href="http://repo.maven.apache.org/maven2/com/goebl/david-webb/">RELEASE Versions</a></li>
</ul>

<h1>
<a id="background" class="anchor" href="#background" aria-hidden="true"><span class="octicon octicon-link"></span></a>Background</h1>

<h2>
<a id="not-for-you" class="anchor" href="#not-for-you" aria-hidden="true"><span class="octicon octicon-link"></span></a>Not for you?</h2>

<p>If <strong>DavidWebb</strong> is too lightweight and you're missing features, you can have a look at:</p>

<ul>
<li>
<a href="http://square.github.io/okhttp/">OkHttp</a> An HTTP &amp; SPDY client for Android and Java applications</li>
<li>
<a href="https://developer.android.com/training/volley/index.html">Volley</a> is an HTTP library that makes networking for
Android apps easier and most importantly, faster.</li>
<li>
<a href="https://code.google.com/p/basic-http-client/">basic-http-client</a>
Basic HTTP client w/ Android AsyncTask wrapper</li>
<li>
<a href="https://github.com/PCreations/RESTDroid">RESTDroid</a>
Resource oriented REST client for Android</li>
<li>
<a href="https://github.com/octo-online/robospice">RoboSpice</a>
RoboSpice is a modular android library that makes writing asynchronous network requests easy!</li>
<li>
<a href="https://github.com/darko1002001/android-rest-client">android-rest-client</a>
A simple rest API client library</li>
<li>
<a href="http://unirest.io/">unirest</a>
Lightweight HTTP Request Library</li>
<li>
<a href="http://restlet.org/">Restlet Framework</a>
The leading web API framework for Java</li>
<li>
<a href="http://datadroid.foxykeep.com/">DataDroid</a> - an Android library for Data Management</li>
<li>
<a href="https://github.com/google/google-http-java-client">google-http-java-client</a> Google HTTP Client Library for Java</li>
<li><a href="https://github.com/octo-online/robospice#alternatives-to-robospice-">More Alternatives (on RoboSpice)</a></li>
<li>(tell me if I missed your award-winning REST-client library!)</li>
</ul>

<h2>
<a id="the-name" class="anchor" href="#the-name" aria-hidden="true"><span class="octicon octicon-link"></span></a>The Name!?</h2>

<p>David <strong>Webb</strong> is the real name of <strong>Jason</strong> Bourne. So <strong>JSON</strong> and <strong>Web</strong>, did you get it?
OK, might be silly, but Bourne 1-3 are my favorite films and so at least I can remember the name.</p>

<p>From Wikipedia:</p>

<blockquote>
<p><a href="http://en.wikipedia.org/wiki/Jason_Bourne">Jason Bourne</a> is a fictional character and the protagonist
of a series of novels by Robert Ludlum and subsequent film adaptations</p>
</blockquote>

<h1>
<a id="license" class="anchor" href="#license" aria-hidden="true"><span class="octicon octicon-link"></span></a>License</h1>

<p>MIT License, see LICENSE file</p>

<h1>
<a id="testing" class="anchor" href="#testing" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h1>

<p>The Unit-Tests do not mock any network-libraries, but depend on a small Express-application running.</p>

<p>Run following commands before you start the JUnit-tests or skip the tests in Maven build with command line
option <code>-DskipTests</code></p>

<pre><code>cd src/test/api-test-server
npm install
node .
</code></pre>

<h2>
<a id="android-tests" class="anchor" href="#android-tests" aria-hidden="true"><span class="octicon octicon-link"></span></a>Android Tests</h2>

<p>Before running the Android tests, build with maven, deploy the Android app and be sure to
set the timezone of your emulator to the same as your PC and synchronize date/time,
otherwise some tests will fail:</p>

<p>There is a script (<code>src/test/android/run-tests-emulator.sh</code>) which also builds the test-app with gradle.</p>

<h2>
<a id="coverage" class="anchor" href="#coverage" aria-hidden="true"><span class="octicon octicon-link"></span></a>Coverage</h2>

<p>The test coverage is measured only with the JUnit-tests for JavaSE. As mocking is not easy
to accomplish under Android/Dalvik, coverage is not measured for this runtime environment.</p>

<ul>
<li>Class: 100%</li>
<li>Instructions: 90%</li>
<li>Branches: 79%</li>
<li>see <a href="http://hgoebl.github.io/DavidWebb/jacoco/">JaCoCo Coverage Report</a>
</li>
</ul>

<h1>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span class="octicon octicon-link"></span></a>TODO</h1>

<h2>
<a id="features-planned" class="anchor" href="#features-planned" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features (planned)</h2>

<ul>
<li>support char-sets other than UTF-8</li>
<li>unprefixJson <a href="http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx">http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx</a>
</li>
<li>progress callback during POST requests where size is known in advance</li>
<li>Support for PATCH requests (only when OkHttp is used as a replacement for HttpURLConnection)</li>
</ul>

<h2>
<a id="features-only-ideas" class="anchor" href="#features-only-ideas" aria-hidden="true"><span class="octicon octicon-link"></span></a>Features (only ideas)</h2>

<ul>
<li>provide base classes (or only examples) for using DavidWebb together with <code>AsyncTask</code>
</li>
<li>decorator/interceptor beforeSend - provide hooks to manipulate request before send</li>
<li>decorator/interceptor afterReceive - provide hooks to manipulate raw response after receiving it</li>
</ul>

<p>Create an issue if you want to have one of those ideas implemented.</p>

<h2>
<a id="documentation" class="anchor" href="#documentation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Documentation</h2>

<ul>
<li>Create User-Guide</li>
</ul>

<h2>
<a id="testing-1" class="anchor" href="#testing-1" aria-hidden="true"><span class="octicon octicon-link"></span></a>Testing</h2>

<ul>
<li>Higher coverage</li>
<li>Test against httpbin.org</li>
</ul>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">DavidWebb maintained by <a href="https://github.com/hgoebl">hgoebl</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
