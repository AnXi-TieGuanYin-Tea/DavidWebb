{"name":"DavidWebb","tagline":"Lightweight Java HTTP-Client for calling JSON REST-Services (especially for Android)","body":"# DavidWebb\r\n\r\nLightweight Java HTTP-Client for calling JSON REST-Services (especially made for Android).\r\n\r\n## Problem\r\n\r\nIf you have to call a RESTful Webservice from Java, especially if you are on Android, you have some options:\r\n\r\n * Use `DefaultHttpClient` or `AndroidHttpClient`. It is already deployed on Android and it's easy to use.\r\n   But wait a moment -\r\n   [Google doesn't recommend using it](http://android-developers.blogspot.de/2011/09/androids-http-clients.html),\r\n   only on very old Android versions.\r\n * Use `HttpURLConnection`. This is what Google recommends for newer Android versions (>= Gingerbread).\r\n   It is part of JDK, but it's cumbersome to use (if not to say a nightmare).\r\n * Add `Unirest`, `Restlet` or some other \"all-you-can-eat\", universal, multi-part, File-upload and all-cases\r\n   supporting library which adds some hundred KB of jars to your APK.\r\n\r\n## Solved\r\n\r\n**DavidWebb** is a paper-thin wrapper around\r\n[HttpURLConnection](http://docs.oracle.com/javase/7/docs/api/java/net/HttpURLConnection.html).\r\nIt supports most HTTP communication cases when you talk to REST services and your data is JSON. It is very\r\nlightweight (~18 KB jar) and super-easy to use.\r\n\r\n## Features ##\r\n\r\n  * Supports GET, POST, PUT, DELETE\r\n  * add HTTP headers (per request, per client or globally)\r\n  * convert params to `x-www-form-urlencoded` body **or** URI search params\r\n  * fluent API\r\n  * org.json support (JSONObject, JSONArray) as payload in both directions (up/down)\r\n  * wraps all Exceptions in a WebbException (a RuntimeException)\r\n  * automatically sets many boiler-plate HTTP headers (like 'Accept', 'Content-Type', 'Content-Length')\r\n  * GZip-compression for uploads (POST/PUT)\r\n  * Un-compress gzip/deflate downloads\r\n  * supports HTTPS and enables relaxing SSL-handshake (self-signed certificates, hostname verification)\r\n  * pass-through to \"real\" connection for special cases\r\n  * option to retry the request in case of special errors (503, 504, 'connection reset by peer')\r\n  * multi-valued parameters (since 1.3.0)\r\n  * use streams as input and output (automatically closing underlying HttpURLConnection when stream\r\n    is closed, since 1.3.0)\r\n\r\n## Non-Features ##\r\n\r\nFollowing features are not supported and there are no plans to realize them:\r\n\r\n  * Cookie management (read `Set-Cookie` header from response and set `Cookie` header for request).\r\n    As DavidWebb is just a thin wrapper over HttpURLConnection, you can use `CookieManager`.\r\n  * Comfortable Basic Authentication (it's not hard to implement it above of DavidWebb, see below)\r\n  * Multi-Part upload\r\n  * Mixing URL-parameters and x-www-form-urlencoded POST bodies.<br>\r\n    Workaround: build the URI with the help of `WebbUtils.queryString` and use `Request.param()` for\r\n    the form-fields.\r\n\r\nWhere not stated, the workaround is to use another library or implement it above of DavidWebb.\r\nIf you think your implementation might be useful for others and it's not blowing up the size of\r\nthe JAR, please create a pull request. (Adding heavy dependencies is not an option.)\r\n\r\n# Usage Examples\r\n\r\nBelow you can see some examples of how to use DavidWebb. And here you can find the\r\n[API Documentation](http://hgoebl.github.io/DavidWebb/apidocs/).\r\n\r\n**This is some code from a SyncAdapter of an Android App:**\r\n\r\n```java\r\n// create the client (one-time, can be used from different threads)\r\nWebb webb = Webb.create();\r\nwebb.setBaseUri(SyncPreferences.REST_ENDPOINT);\r\nwebb.setDefaultHeader(Webb.HDR_USER_AGENT, Const.UA);\r\n\r\n// later we authenticate\r\nResponse<JSONObject> response = webb\r\n        .post(\"/session\")\r\n        .param(\"authentication\", createAuthentication(syncPreferences))\r\n        .param(\"deviceId\", syncPreferences.getDeviceId())\r\n        .ensureSuccess()\r\n        .asJsonObject();\r\n\r\nJSONObject apiResult = response.getBody();\r\n\r\nAccessToken accessToken = new AccessToken();\r\naccessToken.token = apiResult.getString(\"token\");\r\naccessToken.validUntil = apiResult.getLong(\"validUntil\");\r\n\r\nwebb.setDefaultHeader(HDR_ACCESS_TOKEN, accessToken.token);\r\n\r\nJSONObject sync = webb.post(\"/startSync\")\r\n        .param(\"lastSync\", syncPreferences.getLastSync())\r\n        .ensureSuccess()\r\n        .asJsonObject()\r\n        .getBody();\r\n\r\n// ... etc. etc.\r\n\r\n// releaseAccessToken\r\nwebb.delete(\"/session\").asVoid();\r\naccessToken = null;\r\n```\r\n\r\n**Using Google Directions API:**\r\n\r\n```java\r\nWebb webb = Webb.create();\r\nJSONObject result = webb\r\n        .get(\"http://maps.googleapis.com/maps/api/directions/json\")\r\n        .param(\"origin\", new GeoPoint(47.8227, 12.096933))\r\n        .param(\"destination\", new GeoPoint(47.8633, 12.215533))\r\n        .param(\"mode\", \"walking\")\r\n        .param(\"sensor\", \"true\")\r\n        .ensureSuccess()\r\n        .asJsonObject()\r\n        .getBody();\r\n\r\nJSONArray routes = result.getJSONArray(\"routes\");\r\n```\r\n\r\n**Deal with \"connection reset by peer\" or other recoverable errors**\r\n\r\nAndroid (at least >= GINGERBREAD) automatically sets the \"Connection\" header to \"keep-alive\".\r\nThis sometimes causes errors, because the server might already have closed the connection without\r\nthe mobile device knowing it. It would be cumbersome to cope with this and other situation where\r\na retry solved all problems. Since version 1.2.0 it is more comfortable for you:\r\n\r\n```java\r\nWebb webb = Webb.create();\r\nJSONObject result = webb\r\n        .get(\"https://example.com/api/request\")\r\n        .retry(1, false) // at most one retry, don't do exponential backoff\r\n        .asJsonObject()\r\n        .getBody();\r\n```\r\n\r\nIn many cases you will need to change the behaviour of how and when to retry a request.\r\nFor this, you can register your own `RetryManager`, see `webb.setRetryManager()`.\r\n\r\n**You have to do Basic Authentication?**\r\n\r\nThis authorization method uses a Base64 encoded string. Unfortunately Java SE doesn't provide a\r\nBase64 encoder. Because DavidWebb wants to be light and Android already provides a Base64 support class,\r\nit's left to you to insert a few lines of code. As you can see, it's not hard work.\r\nUse one of the methods to set a header and set Authorization header by yourself:\r\n\r\n```java\r\nbyte[] credentials = (username + \":\" + password).getBytes(\"UTF-8\");\r\nString auth = \"Basic \" + Base64.encodeToString(credentials, 0);\r\nWebb webb = Webb.create();\r\nwebb.setDefaultHeader(Webb.HDR_AUTHORIZATION, auth);\r\n```\r\n\r\n**More Samples**\r\n\r\nIf you want to see more examples, just have a look at the JUnit TestCase (src/test/java/...).\r\n\r\n## Special Case Android < Froyo\r\n\r\nYou should add this if you build for legacy Android devices:\r\n\r\n```java\r\nif (Build.VERSION.SDK_INT < Build.VERSION_CODES.FROYO) {\r\n    System.setProperty(\"http.keepAlive\", \"false\");\r\n}\r\n```\r\n\r\n## In Case Of Problems\r\n\r\nI've encountered some problems which could be solved by disabling **keep-alive** of HTTP connections.\r\nThe solution above did not always work on recent versions of Android. To be sure to do without\r\nkeep-alive, you can set an HTTP header like this:\r\n\r\n```\r\n// disable 'keep-alive' for all requests created by this instance of Webb\r\nwebb.setDefaultHeader(\"Connection\", \"close\");\r\n\r\n// disable only for this request\r\nRequest<String> request = webb.post(\"/some-resource\").header(\"Connection\", \"close\");\r\n```\r\n# Maven Coordinates\r\n\r\n```xml\r\n<dependency>\r\n    <groupId>com.goebl</groupId>\r\n    <artifactId>david-webb</artifactId>\r\n    <version>1.3.0</version>\r\n</dependency>\r\n```\r\n\r\nGradle\r\n\r\n    'com.goebl:david-webb:1.3.0'\r\n\r\nNot using Maven/Gradle? - Then you can download the plain JAR from following links directly:\r\n\r\n * [SNAPSHOT Versions](https://oss.sonatype.org/content/groups/staging/com/goebl/david-webb/)\r\n * [RELEASE Versions](http://repo.maven.apache.org/maven2/com/goebl/david-webb/)\r\n\r\n# Background\r\n\r\n## Not for you?\r\n\r\nIf **DavidWebb** is too lightweight and you're missing features, you can have a look at:\r\n\r\n  * [OkHttp](http://square.github.io/okhttp/) An HTTP & SPDY client for Android and Java applications\r\n  * [Volley](https://developer.android.com/training/volley/index.html) is an HTTP library that makes networking for\r\n    Android apps easier and most importantly, faster.\r\n  * [basic-http-client](https://code.google.com/p/basic-http-client/)\r\n    Basic HTTP client w/ Android AsyncTask wrapper\r\n  * [RESTDroid](https://github.com/PCreations/RESTDroid)\r\n    Resource oriented REST client for Android\r\n  * [RoboSpice](https://github.com/octo-online/robospice)\r\n    RoboSpice is a modular android library that makes writing asynchronous network requests easy!\r\n  * [android-rest-client](https://github.com/darko1002001/android-rest-client)\r\n    A simple rest API client library\r\n  * [unirest](http://unirest.io/)\r\n    Lightweight HTTP Request Library\r\n  * [Restlet Framework](http://restlet.org/)\r\n    The leading web API framework for Java\r\n  * [DataDroid](http://datadroid.foxykeep.com/) - an Android library for Data Management\r\n  * [google-http-java-client](https://github.com/google/google-http-java-client) Google HTTP Client Library for Java\r\n  * [More Alternatives (on RoboSpice)](https://github.com/octo-online/robospice#alternatives-to-robospice-)\r\n  * (tell me if I missed your award-winning REST-client library!)\r\n\r\n## The Name!?\r\n\r\nDavid **Webb** is the real name of **Jason** Bourne. So **JSON** and **Web**, did you get it?\r\nOK, might be silly, but Bourne 1-3 are my favorite films and so at least I can remember the name.\r\n\r\nFrom Wikipedia:\r\n\r\n> [Jason Bourne](http://en.wikipedia.org/wiki/Jason_Bourne) is a fictional character and the protagonist\r\nof a series of novels by Robert Ludlum and subsequent film adaptations\r\n\r\n# License\r\n\r\nMIT License, see LICENSE file\r\n\r\n# Testing\r\n\r\nThe Unit-Tests do not mock any network-libraries, but depend on a small Express-application running.\r\n\r\nRun following commands before you start the JUnit-tests or skip the tests in Maven build with command line\r\noption `-DskipTests`\r\n\r\n```\r\ncd src/test/api-test-server\r\nnpm install\r\nnode .\r\n```\r\n\r\n## Android Tests\r\n\r\nBefore running the Android tests, build with maven, deploy the Android app and be sure to\r\nset the timezone of your emulator to the same as your PC and synchronize date/time,\r\notherwise some tests will fail:\r\n\r\nThere is a script (`src/test/android/run-tests-emulator.sh`) which also builds the test-app with gradle.\r\n\r\n## Coverage\r\n\r\nThe test coverage is measured only with the JUnit-tests for JavaSE. As mocking is not easy\r\nto accomplish under Android/Dalvik, coverage is not measured for this runtime environment.\r\n\r\n  * Class: 100%\r\n  * Instructions: 90%\r\n  * Branches: 79%\r\n  * see [JaCoCo Coverage Report](http://hgoebl.github.io/DavidWebb/jacoco/)\r\n\r\n# TODO\r\n\r\n## Features (planned)\r\n  * support char-sets other than UTF-8\r\n  * unprefixJson <http://haacked.com/archive/2008/11/20/anatomy-of-a-subtle-json-vulnerability.aspx>\r\n  * progress callback during POST requests where size is known in advance\r\n  * Support for PATCH requests (only when OkHttp is used as a replacement for HttpURLConnection)\r\n\r\n## Features (only ideas)\r\n  * provide base classes (or only examples) for using DavidWebb together with `AsyncTask`\r\n  * decorator/interceptor beforeSend - provide hooks to manipulate request before send\r\n  * decorator/interceptor afterReceive - provide hooks to manipulate raw response after receiving it\r\n\r\nCreate an issue if you want to have one of those ideas implemented.\r\n\r\n## Documentation\r\n  * Create User-Guide\r\n\r\n## Testing\r\n  * Higher coverage\r\n  * Test against httpbin.org\r\n\r\n# Contributors\r\n\r\n * [essobedo](https://github.com/essobedo)\r\n","google":"","note":"Don't delete this file! It's used internally to help with page regeneration."}